<h1 class="title">{{pageTitle}}</h1>

<ng-container *ngIf="!loading && !error; else loadingOrError">
    <ng-container *ngIf="hasData(); else noDataTemplate">
        <ng-container *ngIf="filterOptions.length > 0">
            <ng-container *ngTemplateOutlet="filterTemplate"></ng-container>
        </ng-container>
        <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">
            <ng-container *ngFor="let column of columns" [matColumnDef]="getColumnKey(column)">
                <ng-container *ngIf="column.isSortable; else nonSortableHeader">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header class="mat-header-cell">
                        {{ column.label }}
                    </th>
                </ng-container>
                <ng-template #nonSortableHeader>
                    <th mat-header-cell *matHeaderCellDef class="mat-header-cell">
                        {{ column.label }}
                    </th>
                </ng-template>
                <td mat-cell *matCellDef="let element" class="mat-cell">
                    <ng-container *ngIf="column.dataKey === 'nearMapImageDate'; else defaultCell">
                        {{ element[column.dataKey] | date:'MMM d, y, h:mm a' }}
                    </ng-container>
                    <ng-template #defaultCell>
                        {{ element[column.dataKey] }}
                    </ng-template>
                </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns" class="mat-header-row"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="mat-row"></tr>
        </table>
    </ng-container>
    <mat-paginator [pageSizeOptions]="[10, 30, 50]" [pageSize]="20" showFirstLastButtons></mat-paginator>
</ng-container>


<ng-template #loadingOrError>
    <div *ngIf="loading; else errorTemplate" class="spinner-container">
        <mat-spinner></mat-spinner>
    </div>
</ng-template>

<ng-template #errorTemplate>
    <div class="error">{{error}}</div>
</ng-template>

<ng-template #noDataTemplate>
    <div class="no-data">No data available</div>
</ng-template>

<ng-template #filterTemplate>
    <div class="filter-section">
        <mat-form-field appearance="outline">
            <mat-label>Filter by Subdivision Status</mat-label>
            <mat-select [(value)]="selectedFilter" (selectionChange)="filterData($event.value)">
                <mat-option *ngFor="let option of filterOptions" [value]="option.value">
                    {{ option.key }}
                </mat-option>
            </mat-select>
        </mat-form-field>
    </div>
</ng-template>